function play(){if(player){player.playVideo()}}function handle(a){if(a.keyCode===13){model.searchVideo()}return true}function Video(d,f,c){var a=this;a.index=ko.observable(1);a.name=ko.observable(d);a.desc=ko.observable(f);a.urlof=ko.observable(c);a.playing=ko.observable("0");var b=c.indexOf("v=");var e="http://i.ytimg.com/vi/"+c.substring(b+2)+"/default.jpg";a.isrc=ko.observable(e)}function ReservationsViewModel(c){var a=this;this.data=c;this.videoName=ko.observable("");this.videoUrl=ko.observable("");this.searchKeyword=ko.observable("");this.paused=ko.observable(false);this.muted=ko.observable(false);this.repeat=ko.observable(false);this.lastUpdate=ko.observable("");this.loaded=ko.observable("0");a.videos=ko.observableArray([new Video("Josef Salvat","Josef Salvat - Diamonds","https://www.youtube.com/watch?v=_koFbsnw_PM")]);a.searchVideos=ko.observableArray();a.playVideo=function(e){a.removeSearchResults();if(e.urlof().indexOf("rtmp://")>-1){if(e.urlof().indexOf("flv")>-1){player.src({type:"rtmp/flv",src:e.urlof()})}else{player.src({type:"rtmp/mp4",src:e.urlof()})}}else{if(e.urlof().indexOf("youtube.com")>-1){player.src({type:"video/youtube",src:e.urlof()})}else{if(e.urlof().indexOf("vimeo.com")>-1){player.src({type:"video/vimeo",src:e.urlof()})}else{if(e.urlof().indexOf("dailymotion.com")>-1){player.src({type:"video/dailymotion",src:e.urlof()})}else{if(e.urlof().indexOf("soundcloud.com")>-1){player.src({type:"audio/soundcloud",src:e.urlof()})}else{player.src({type:"application/x-mpegURL",src:e.urlof()})}}}}}player.play();a.paused(false);var d=a.videos().length;for(var f=0;f<d;f++){a.videos()[f].playing("0")}e.playing("1")};a.init=function(){if(a.data!=null&&a.data!=""){a.videos.removeAll();var d=a.data.length;for(var e=0;e<d;e++){a.videos.push(new Video(a.data[e].name,a.data[e].desc,a.data[e].urlof))}}};$(document).ready(function(){a.init();player.ready(function(){model.playVideo(model.videos()[0])});$(function(){$("#keyword").autocomplete({source:function(e,d){$.ajax({url:"http://suggestqueries.google.com/complete/search?client=youtube&ds=yt&q="+escape(document.getElementById("keyword").value),dataType:"jsonp",data:{featureClass:"P",style:"full",maxRows:12},success:function(f){d($.map(f[1],function(g){return{label:g[0],value:g[0]}}))}})}})})});a.shuffle=function b(){console.log("shuffle");var d=a.videos().length,e,f;while(0!==d){f=Math.floor(Math.random()*d);d-=1;e=a.videos()[d];a.videos()[d]=a.videos()[f];a.videos()[f]=e}a.videos.valueHasMutated()};a.muteVideo=function(){if(player.muted()){player.muted(false)}else{player.muted(true)}this.muted(player.muted())};a.pauseVideo=function(){if(player.paused()){player.play()}else{player.pause()}this.paused(!player.paused())};a.playFirstVideo=function(){a.playVideo(a.videos()[0])};a.playLastVideo=function(){a.playVideo(a.videos()[a.videos().length-1])};a.playNextVideo=function(){var d=a.videos().length;var f=-1;for(var e=0;e<d;e++){if(a.videos()[e].playing()=="1"){f=e}}if(f>=0){a.playVideo(a.videos()[(f+1)%d])}};a.playPreviousVideo=function(){var d=a.videos().length;var f=-1;for(var e=0;e<d;e++){if(a.videos()[e].playing()=="1"){f=e}}if(f>0){a.playVideo(a.videos()[f-1])}else{if(f==0){a.playVideo(a.videos()[d-1])}}};a.setRepeatMode=function(){if(this.repeat()){this.repeat(false)}else{this.repeat(true)}};a.addVideo=function(){var g=this.videoUrl();if(g.indexOf("youtube.com")!=-1){var f=g.indexOf("v=");var e="https://www.googleapis.com/youtube/v3/videos?id="+g.substring(f+2)+"&key=AIzaSyCkMlk2YRsESJ8yKDBEAfHNN210Wb-bB4c&part=snippet,contentDetails,statistics,status";$.getJSON(e,function(h){e="http://www.youtube.com/watch?v="+h.items[0].id.videoId;a.videos.unshift(new Video(h.items[0].snippet.title,h.items[0].snippet.description.substring(0,100),g))})}else{var d=g.substr(g.lastIndexOf("/")+1);a.videos.unshift(new Video(d,d,g))}this.videoName("");this.videoUrl("");update(ko.toJSON(a.videos()))};a.removeSearchResults=function(){a.searchVideos.removeAll();if(document.getElementById("hideresults")!=null){document.getElementById("hideresults").style.display="none"}};a.searchVideo=function(){a.removeSearchResults();if(document.getElementById("hideresults")!=null){document.getElementById("hideresults").style.display="block"}if(document.getElementById("keyword")!=null){var e=document.getElementById("keyword").value}var d="https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q="+escape(e)+"&key=AIzaSyCkMlk2YRsESJ8yKDBEAfHNN210Wb-bB4c";$.getJSON(d,function(g){for(var f=0;f<g.items.length;f++){d="http://www.youtube.com/watch?v="+g.items[f].id.videoId;a.searchVideos.push(new Video(g.items[f].snippet.title,g.items[f].snippet.description.substring(0,100),d))}})};a.addSearchedVideo=function(d){a.videos.unshift(d);a.searchVideos.remove(d);update(ko.toJSON(a.videos()))};a.playSearchedVideo=function(d){a.videos.unshift(d);a.playVideo(d)};a.removeVideo=function(d){if(d.playing()!="1"){a.videos.remove(d)}else{if(a.videos().length==1){a.videos.remove(a.videos()[0]);player.pause()}else{a.playNextVideo();a.videos.remove(d)}}update(ko.toJSON(a.videos()))};setInterval(function(){if(player.ended()==true){if(a.repeat()){player.play()}else{a.playNextVideo()}}if(player.paused()&&player.error()!=null){player.pause().currentTime(0).trigger("loadstart");a.playNextVideo()}},3000);a.removeAll=function(){var d=a.videos().length;for(var e=0;e<d;e++){a.videos.remove(a.videos()[0]);player.pause()}update(ko.toJSON(a.videos()))};a.moveUp=function(m){var h=a.videos().length;var g=0;for(var f=0;f<h;f++){if(a.videos()[f]==m){g=f}}if(g>0){var e=a.videos()[g-1].name();var l=a.videos()[g-1].urlof();var j=a.videos()[g-1].isrc();var k=a.videos()[g-1].desc();var d=a.videos()[g-1].playing();a.videos()[g-1].name(a.videos()[g].name());a.videos()[g-1].urlof(a.videos()[g].urlof());a.videos()[g-1].isrc(a.videos()[g].isrc());a.videos()[g-1].desc(a.videos()[g].desc());a.videos()[g-1].playing(a.videos()[g].playing());a.videos()[g].name(e);a.videos()[g].urlof(l);a.videos()[g].isrc(j);a.videos()[g].desc(k);a.videos()[g].playing(d)}update(ko.toJSON(a.videos()))};a.moveDown=function(l){var h=a.videos().length;var g=0;for(var f=0;f<h;f++){if(a.videos()[f]==l){g=f}}if(g<h-1){var d=a.videos()[g+1].name();var m=a.videos()[g+1].urlof();var k=a.videos()[g+1].isrc();var j=a.videos()[g+1].desc();var e=a.videos()[g+1].playing();a.videos()[g+1].name(a.videos()[g].name());a.videos()[g+1].urlof(a.videos()[g].urlof());a.videos()[g+1].isrc(a.videos()[g].isrc());a.videos()[g+1].desc(a.videos()[g].desc());a.videos()[g+1].playing(a.videos()[g].playing());a.videos()[g].name(d);a.videos()[g].urlof(m);a.videos()[g].isrc(k);a.videos()[g].desc(j);a.videos()[g].playing(e)}update(ko.toJSON(a.videos()))}};